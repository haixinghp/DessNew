/********************************************************************************************************************
 * @file:      DRV_CLOCK.c
 * @author:    gushengchi
 * @version:   V01.00
 * @date:      2021-08-05
 * @brief:     芯片CLOCK初始化函数
*********************************************************************************************************************/

/*-------------------------------------------------文件包含---------------------------------------------------------*/
#include "DRV_CLK.h"
#include "APP_GUI.h"
#include "Public.h"
#include "ISR.h"
#include "DRV_GPIO.h"
#include "..\HAL\HAL_Motor\HAL_Motor.h"

#include "app_flags.h"
#if F_BT_DLPS_EN
#include <dlps.h>
#include <rtl876x_io_dlps.h>
#endif
/*-------------------------------------------------宏定义-----------------------------------------------------------*/




/*-------------------------------------------------枚举定义---------------------------------------------------------*/




/*-------------------------------------------------常量定义---------------------------------------------------------*/




/*-------------------------------------------------全局变量定义-----------------------------------------------------*/
bool Dlps_Enabled =false;



/*-------------------------------------------------函数声明---------------------------------------------------------*/




/*-------------------------------------------------函数定义---------------------------------------------------------*/
/*********************************************************************************************************************
* Function Name :  DRV_SysMgmt_Init()
* Description   :  系统工作工作模式
* Para          :  无
* Return        :  void
*********************************************************************************************************************/
void DRV_SysMgmt_Init( void )
{
	
	return;
}


/*********************************************************************************************************************
* Function Name :  DRV_HFClock_Request()
* Description   :  唤醒外部高频
* Para          :  无
* Return        :  void
*********************************************************************************************************************/
void DRV_HFClock_Request( void )
{
	return;
}

/*********************************************************************************************************************
* Function Name :  DRV_HFClock_Release()
* Description   :  释放外部高频
* Para          :  无
* Return        :  void
*********************************************************************************************************************/
void DRV_HFClock_Release( void )
{
	
	return;
}


/*********************************************************************************************************************
* Function Name :  DRV_SysMgmt_Run()
* Description   :  系统工作工作模式   ,无任务休眠
* Para          :  无
* Return        :  void
*********************************************************************************************************************/
void DRV_SysMgmt_Run( void )
{
	my_printf( "Dlps_Enabled" );  
//	//PAD中断重新打开一次
//	HAL_Motor_SleepInit();
//	SystemWakeupPin_ISR_Enable();
//	DRV_GpioSleep();	
	Dlps_Enabled =true;
	return;
}


//休眠前回调   
void io_dlps_enter_cb(void)
{
	//my_printf( "io_dlps_enter_cb()\n" );  
	//PAD中断重新打开一次，休眠时蓝牙广播和定时器中断也会进来，对功耗有轻微影响
	HAL_Motor_SleepInit();
	SystemWakeupPin_ISR_Enable();
	DRV_GpioSleep();
}
//唤醒后回调
void io_dlps_exit_cb(void)
{
	//my_printf( "io_dlps_exit_cb()\n" );   
}
//休眠确认
bool app_dlps_check_cb(void)
{
	return Dlps_Enabled;
}

void DRV_Pwr_Mgr_Init(void)
{
#if F_BT_DLPS_EN
	if (false == dlps_check_cb_reg(app_dlps_check_cb))
    {
        APP_PRINT_ERROR0("Error: dlps_check_cb_reg(app_dlps_check_cb) failed!");
    }
    DLPS_IORegUserDlpsEnterCb(io_dlps_enter_cb);
    DLPS_IORegUserDlpsExitCb(io_dlps_exit_cb);
    DLPS_IORegister();
    lps_mode_set(LPM_DLPS_MODE);
#endif
}











/*-------------------------------------------------THE FILE END-----------------------------------------------------*/

